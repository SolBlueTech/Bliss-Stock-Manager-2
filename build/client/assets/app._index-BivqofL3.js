import{y as o,r as p,u as ae,z as se,A as oe,B as ie,C as re,j as s}from"./components-TJrgxJd3.js";import{c as z,v as X,T as E,d as G,u as le,I as ce,S as de,L as ue,h as pe,e as N,f as fe,b as U,P as me,C as V,B as W,a as q,D as ge,g as he}from"./Page-DCVyfzQs.js";import"./context-BrouWIlE.js";var S={Layout:"Polaris-Layout",Section:"Polaris-Layout__Section","Section-fullWidth":"Polaris-Layout__Section--fullWidth","Section-oneHalf":"Polaris-Layout__Section--oneHalf","Section-oneThird":"Polaris-Layout__Section--oneThird",AnnotatedSection:"Polaris-Layout__AnnotatedSection",AnnotationWrapper:"Polaris-Layout__AnnotationWrapper",AnnotationContent:"Polaris-Layout__AnnotationContent",Annotation:"Polaris-Layout__Annotation"},Y={TextContainer:"Polaris-TextContainer",spacingTight:"Polaris-TextContainer--spacingTight",spacingLoose:"Polaris-TextContainer--spacingLoose"};function Se({spacing:e,children:n}){const t=z(Y.TextContainer,e&&Y[X("spacing",e)]);return o.createElement("div",{className:t},n)}function ve({children:e,title:n,description:t,id:r}){const l=typeof t=="string"?o.createElement(E,{as:"p",variant:"bodyMd"},t):t;return o.createElement("div",{className:S.AnnotatedSection},o.createElement("div",{className:S.AnnotationWrapper},o.createElement("div",{className:S.Annotation},o.createElement(Se,{spacing:"tight"},o.createElement(E,{id:r,variant:"headingMd",as:"h2"},n),l&&o.createElement(G,{color:"text-secondary"},l))),o.createElement("div",{className:S.AnnotationContent},e)))}function ee({children:e,variant:n}){const t=z(S.Section,S[`Section-${n}`]);return o.createElement("div",{className:t},e)}const I=function({sectioned:n,children:t}){const r=n?o.createElement(ee,null,t):t;return o.createElement("div",{className:S.Layout},r)};I.AnnotatedSection=ve;I.Section=ee;var u={Select:"Polaris-Select",disabled:"Polaris-Select--disabled",error:"Polaris-Select--error",Backdrop:"Polaris-Select__Backdrop",Input:"Polaris-Select__Input",Content:"Polaris-Select__Content",InlineLabel:"Polaris-Select__InlineLabel",Icon:"Polaris-Select__Icon",SelectedOption:"Polaris-Select__SelectedOption",Prefix:"Polaris-Select__Prefix",hover:"Polaris-Select--hover",toneMagic:"Polaris-Select--toneMagic"};const Z="";function xe({options:e,label:n,labelAction:t,labelHidden:r,labelInline:l,disabled:c,helpText:C,placeholder:_,id:L,name:d,value:v=Z,error:m,onChange:A,onFocus:g,onBlur:x,requiredIndicator:T,tone:y}){const{value:w,toggle:b}=le(!1),k=p.useId(),f=L??k,O=l?!0:r,M=z(u.Select,m&&u.error,y&&u[X("tone",y)],c&&u.disabled),B=p.useCallback(j=>{b(),g==null||g(j)},[g,b]),H=p.useCallback(j=>{b(),x==null||x(j)},[x,b]),R=A?j=>A(j.currentTarget.value,f):void 0,P=[];C&&P.push(pe(f)),m&&P.push(`${f}Error`);let a=(e||[]).map(ye);_&&(a=[{label:_,value:Z,disabled:!0},...a]);const i=l&&o.createElement(G,{paddingInlineEnd:"100"},o.createElement(E,{as:"span",variant:"bodyMd",tone:y&&y==="magic"&&!w?"magic-subdued":"subdued",truncate:!0},n)),h=be(a,v),$=h.prefix&&o.createElement("div",{className:u.Prefix},h.prefix),te=o.createElement("div",{className:u.Content,"aria-hidden":!0,"aria-disabled":c},i,$,o.createElement("span",{className:u.SelectedOption},h.label),o.createElement("span",{className:u.Icon},o.createElement(ce,{source:de}))),ne=a.map(Ee);return o.createElement(ue,{id:f,label:n,error:m,action:t,labelHidden:O,helpText:C,requiredIndicator:T,disabled:c},o.createElement("div",{className:M},o.createElement("select",{id:f,name:d,value:v,className:u.Input,disabled:c,onFocus:B,onBlur:H,onChange:R,"aria-invalid":!!m,"aria-describedby":P.length?P.join(" "):void 0,"aria-required":T},ne),te,o.createElement("div",{className:u.Backdrop})))}function J(e){return typeof e=="string"}function F(e){return typeof e=="object"&&"options"in e&&e.options!=null}function K(e){return{label:e,value:e}}function ye(e){if(J(e))return K(e);if(F(e)){const{title:n,options:t}=e;return{title:n,options:t.map(r=>J(r)?K(r):r)}}return e}function be(e,n){const t=Pe(e);let r=t.find(l=>n===l.value);return r===void 0&&(r=t.find(l=>!l.hidden)),r||{value:"",label:""}}function Pe(e){let n=[];return e.forEach(t=>{F(t)?n=n.concat(t.options):n.push(t)}),n}function Q(e){const{value:n,label:t,prefix:r,key:l,...c}=e;return o.createElement("option",Object.assign({key:l??n,value:n},c),t)}function Ee(e){if(F(e)){const{title:n,options:t}=e;return o.createElement("optgroup",{label:n,key:n},t.map(Q))}return Q(e)}const Ce="ui-title-bar",_e=new Proxy({},{get(e,n){throw Error(`shopify.${String(n)} can't be used in a server environment. You likely need to move this code into an Effect.`)}});function Te(){if(typeof window>"u")return _e;if(!window.shopify)throw Error("The shopify global is not defined. This likely means the App Bridge script tag was not added correctly to this page");return window.shopify}const je=25;function Le(e){return e?typeof e=="string"?e:typeof e.message=="string"?e.message:"Saved":"Saved"}function Ie(){const{items:e=[],totalVariants:n=0,page:t=1,pageSize:r=je,titles:l=[]}=ae()??{},[c]=se(),C=oe(),_=ie(),L=Te(),d=re(),v=p.useRef(!1),m=["loading","submitting"].includes(d.state)&&d.formMethod==="POST";p.useEffect(()=>{m&&(v.current=!1)},[m]),p.useEffect(()=>{var i;if(d.state==="idle"&&((i=d.data)==null?void 0:i.ok)&&!v.current){v.current=!0;try{L.toast.show(Le(d.data))}catch{}_.revalidate()}},[d.state,d.data,_,L]);const A=c.get("title")||"",[g,x]=p.useState(A),T=a=>{x(a);const i=new URLSearchParams(c);a?i.set("title",a):i.delete("title"),i.set("page","1"),C(`?${i.toString()}`,{preventScrollReset:!0,replace:!0})},y=[{label:"All products",value:""},...l.map(a=>({label:a,value:a}))],w=t>1,b=n>t*r,k=a=>{const i=new URLSearchParams(c);i.set("page",String(a)),C(`?${i.toString()}`,{preventScrollReset:!0})},[f,O]=p.useState({}),M=(a,i)=>O(h=>({...h,[a]:i})),B=a=>{const i=new FormData;i.set("variantId",a),i.set("counted",f[a]??""),d.submit(i,{method:"POST",action:"/app/counts/add"})},H=["Title","Variant","Last Saved","Add Count"],R=["text","text","text","text"],P=p.useMemo(()=>e.map(a=>{const i=f[a.variantId]??"",h=a.latestCount==null?"—":String(a.latestCount);return[a.productTitle,a.variantTitle,h,s.jsxs(N,{gap:"100",children:[s.jsx(fe,{label:"Count",labelHidden:!0,autoComplete:"off",type:"number",min:0,value:i,onChange:$=>M(a.variantId,$),placeholder:"Enter count"}),s.jsx(U,{onClick:()=>B(a.variantId),children:"Save"})]},`add-${a.variantId}`)]}),[e,f]),D=p.useMemo(()=>{let a=0;for(const i of e)i.latestCount!=null&&a++;return{total:e.length,withCount:a}},[e]);return s.jsxs(me,{children:[s.jsx(Ce,{title:"Inventory — Staff"}),s.jsx(I,{children:s.jsxs(I.Section,{children:[s.jsx(V,{children:s.jsxs(W,{gap:"200",children:[s.jsx(E,{as:"h2",variant:"headingSm",children:"Summary (this page)"}),s.jsxs(N,{gap:"300",children:[s.jsxs(q,{tone:"new",children:["Total variants: ",D.total]}),s.jsxs(q,{tone:"success",children:["With saved count: ",D.withCount]})]})]})}),s.jsx(V,{children:s.jsxs(W,{gap:"300",children:[s.jsx(E,{as:"h2",variant:"headingSm",children:"Filter"}),s.jsxs(N,{gap:"200",align:"start",blockAlign:"center",children:[s.jsx(xe,{label:"Product title",labelHidden:!0,options:y,value:g,onChange:T}),g!==""&&s.jsx(U,{onClick:()=>T(""),variant:"plain",children:"Clear"})]})]})}),s.jsx(V,{children:s.jsxs(W,{gap:"300",children:[s.jsx(ge,{columnContentTypes:R,headings:H,rows:P,stickyHeader:!0}),s.jsxs(N,{align:"center",blockAlign:"center",gap:"300",children:[s.jsx(he,{hasPrevious:w,onPrevious:()=>k(t-1),hasNext:b,onNext:()=>k(t+1)}),s.jsxs(E,{as:"span",variant:"bodySm",children:["Page ",t," · ",Math.min(t*r,n)," of ",n," variants"]})]})]})})]})})]})}export{Ie as default};
